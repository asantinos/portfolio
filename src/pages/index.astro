---
import Layout from "../layouts/RootLayout.astro";
---

<Layout title="Álex Santos | Terminal" description="Software Developer">
  <div class="min-h-screen bg-[#1a1a2e] flex items-center justify-center p-4">
    <!-- Terminal Window -->
    <div class="w-full max-w-3xl">
      <!-- Terminal Header -->
      <div class="bg-[#3a3a3a] rounded-t-lg px-4 py-3 flex items-center gap-2">
        <div class="flex gap-2">
          <div class="w-3 h-3 rounded-full bg-[#ff5f56] hover:brightness-110 cursor-pointer"></div>
          <div class="w-3 h-3 rounded-full bg-[#ffbd2e] hover:brightness-110 cursor-pointer"></div>
          <div class="w-3 h-3 rounded-full bg-[#27ca3f] hover:brightness-110 cursor-pointer"></div>
        </div>
        <div class="flex-1 text-center">
          <span class="text-[#a0a0a0] text-sm font-medium">alex@portfolio — zsh</span>
        </div>
        <div class="w-14"></div>
      </div>

      <!-- Terminal Body -->
      <div
        id="terminal"
        class="bg-[#1e1e1e] rounded-b-lg p-4 font-mono text-sm min-h-[500px] max-h-[70vh] overflow-y-auto focus:outline-none"
        tabindex="0"
      >
        <div id="output"></div>
        <div id="input-line" class="flex items-start">
          <span class="text-[#27ca3f] mr-2 shrink-0">➜</span>
          <span class="text-[#6bc1ff] mr-2 shrink-0">~</span>
          <span id="current-input" class="text-white"></span>
          <span id="cursor" class="bg-white w-2 h-5 inline-block animate-pulse"></span>
        </div>
      </div>

      <!-- Instructions -->
      <div class="mt-4 text-center text-[#6b7280] text-sm">
        <p>Type a command or use <kbd class="px-2 py-1 bg-[#2a2a3e] rounded text-xs">↑</kbd> <kbd class="px-2 py-1 bg-[#2a2a3e] rounded text-xs">↓</kbd> to navigate history · <kbd class="px-2 py-1 bg-[#2a2a3e] rounded text-xs">Enter</kbd> to execute · <kbd class="px-2 py-1 bg-[#2a2a3e] rounded text-xs">Tab</kbd> to autocomplete</p>
      </div>
    </div>
  </div>
</Layout>

<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');

  #terminal {
    font-family: 'JetBrains Mono', 'SF Mono', 'Fira Code', monospace;
    line-height: 1.6;
  }

  #terminal::-webkit-scrollbar {
    width: 8px;
  }

  #terminal::-webkit-scrollbar-track {
    background: #1e1e1e;
  }

  #terminal::-webkit-scrollbar-thumb {
    background: #3a3a3a;
    border-radius: 4px;
  }

  .typing-animation {
    overflow: hidden;
    white-space: nowrap;
    animation: typing 0.5s steps(40, end);
  }

  @keyframes typing {
    from { width: 0; }
    to { width: 100%; }
  }

  @keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
  }

  #cursor {
    animation: blink 1s step-end infinite;
  }

  .menu-item {
    transition: all 0.1s ease;
  }

  .menu-item.selected {
    background: rgba(107, 193, 255, 0.1);
  }
</style>

<script>
  const terminal = document.getElementById('terminal')!;
  const output = document.getElementById('output')!;
  const currentInput = document.getElementById('current-input')!;
  const cursor = document.getElementById('cursor')!;

  let inputBuffer = '';
  let commandHistory: string[] = [];
  let historyIndex = -1;
  let menuMode = false;
  let menuItems: string[] = [];
  let menuIndex = 0;
  let currentMenu = '';

  const commands: Record<string, () => void> = {
    help: showHelp,
    about: showAbout,
    projects: showProjects,
    skills: showSkills,
    contact: showContact,
    clear: clearTerminal,
    welcome: showWelcome,
  };

  const commandList = Object.keys(commands);

  function typeText(text: string, element: HTMLElement, speed = 10): Promise<void> {
    return new Promise((resolve) => {
      let i = 0;
      element.textContent = '';
      const interval = setInterval(() => {
        if (i < text.length) {
          element.textContent += text[i];
          i++;
          scrollToBottom();
        } else {
          clearInterval(interval);
          resolve();
        }
      }, speed);
    });
  }

  function addLine(content: string, className = '') {
    const line = document.createElement('div');
    line.className = className;
    line.innerHTML = content;
    output.appendChild(line);
    scrollToBottom();
  }

  function addPromptLine(command: string) {
    addLine(`<span class="text-[#27ca3f]">➜</span> <span class="text-[#6bc1ff]">~</span> <span class="text-white">${command}</span>`);
  }

  function scrollToBottom() {
    terminal.scrollTop = terminal.scrollHeight;
  }

  function clearTerminal() {
    output.innerHTML = '';
    exitMenu();
  }

  function showWelcome() {
    addLine('<pre class="text-[#6bc1ff] leading-none"> █████╗ ██╗     ███████╗██╗  ██╗\n██╔══██╗██║     ██╔════╝╚██╗██╔╝\n███████║██║     █████╗   ╚███╔╝\n██╔══██║██║     ██╔══╝   ██╔██╗\n██║  ██║███████╗███████╗██╔╝ ██╗\n╚═╝  ╚═╝╚══════╝╚══════╝╚═╝  ╚═╝</pre>');
    addLine('');
    addLine('<span class="text-[#a0a0a0]">Welcome to my interactive portfolio terminal.</span>');
    addLine('<span class="text-[#a0a0a0]">Type <span class="text-[#ffbd2e]">help</span> to see available commands.</span>');
    addLine('');
  }

  function showHelp() {
    addLine('');
    addLine('<span class="text-[#ffbd2e]">Available commands:</span>');
    addLine('');
    addLine('  <span class="text-[#27ca3f]">about</span>      <span class="text-[#a0a0a0]">- Learn about me</span>');
    addLine('  <span class="text-[#27ca3f]">projects</span>   <span class="text-[#a0a0a0]">- View my projects</span>');
    addLine('  <span class="text-[#27ca3f]">skills</span>     <span class="text-[#a0a0a0]">- See my technical skills</span>');
    addLine('  <span class="text-[#27ca3f]">contact</span>    <span class="text-[#a0a0a0]">- Get in touch</span>');
    addLine('  <span class="text-[#27ca3f]">clear</span>      <span class="text-[#a0a0a0]">- Clear the terminal</span>');
    addLine('  <span class="text-[#27ca3f]">help</span>       <span class="text-[#a0a0a0]">- Show this message</span>');
    addLine('');
  }

  function showAbout() {
    addLine('');
    addLine('<span class="text-[#6bc1ff]">━━━ About Me ━━━</span>');
    addLine('');
    addLine('<span class="text-white">Álex Santos</span>');
    addLine('<span class="text-[#a0a0a0]">Software Developer from Asturias, Spain</span>');
    addLine('');
    addLine('<span class="text-[#a0a0a0]">I craft iOS & web applications with a focus on</span>');
    addLine('<span class="text-[#a0a0a0]">minimalist UI/UX design. Passionate about creating</span>');
    addLine('<span class="text-[#a0a0a0]">products that people enjoy using.</span>');
    addLine('');
    addLine('<span class="text-[#27ca3f]">→</span> <span class="text-[#a0a0a0]">Location:</span>  <span class="text-white">Asturias, Spain</span>');
    addLine('<span class="text-[#27ca3f]">→</span> <span class="text-[#a0a0a0]">Focus:</span>     <span class="text-white">iOS, Web, UI/UX</span>');
    addLine('<span class="text-[#27ca3f]">→</span> <span class="text-[#a0a0a0]">Languages:</span> <span class="text-white">Spanish, English</span>');
    addLine('');
  }

  function showProjects() {
    menuMode = true;
    currentMenu = 'projects';
    menuItems = ['stride', 'back'];
    menuIndex = 0;

    addLine('');
    addLine('<span class="text-[#6bc1ff]">━━━ Projects ━━━</span>');
    addLine('<span class="text-[#a0a0a0]">Use ↑↓ to navigate, Enter to select, Esc to go back</span>');
    addLine('');
    renderProjectsMenu();
  }

  function renderProjectsMenu() {
    const menuContainer = document.getElementById('projects-menu');
    if (menuContainer) menuContainer.remove();

    const menu = document.createElement('div');
    menu.id = 'projects-menu';

    const projects = [
      { id: 'stride', name: 'Stride', desc: 'iOS steps tracking app', tech: 'Expo, SwiftUI, HealthKit' },
    ];

    projects.forEach((project, i) => {
      const selected = menuIndex === i;
      menu.innerHTML += `
        <div class="menu-item py-2 px-3 rounded ${selected ? 'selected bg-[#2a2a3e]' : ''}">
          <span class="text-[#ffbd2e]">${selected ? '▶' : ' '}</span>
          <span class="text-[#27ca3f] ml-2">${project.name}</span>
          <span class="text-[#a0a0a0] ml-2">- ${project.desc}</span>
          <div class="ml-6 text-[#6b7280] text-xs mt-1">${project.tech}</div>
        </div>
      `;
    });

    // Back option
    const backSelected = menuIndex === projects.length;
    menu.innerHTML += `
      <div class="menu-item py-2 px-3 rounded mt-2 ${backSelected ? 'selected bg-[#2a2a3e]' : ''}">
        <span class="text-[#ffbd2e]">${backSelected ? '▶' : ' '}</span>
        <span class="text-[#ff5f56] ml-2">← Back</span>
      </div>
    `;

    output.appendChild(menu);
    scrollToBottom();
  }

  function selectProject(index: number) {
    if (index === menuItems.length - 1) {
      exitMenu();
      addLine('<span class="text-[#a0a0a0]">Returned to main prompt.</span>');
      addLine('');
      return;
    }

    const projectId = menuItems[index];
    exitMenu();

    if (projectId === 'stride') {
      addLine('');
      addLine('<span class="text-[#6bc1ff]">━━━ Stride ━━━</span>');
      addLine('');
      addLine('<span class="text-[#ffbd2e]">iOS Steps Tracking App</span>');
      addLine('');
      addLine('<span class="text-[#a0a0a0]">A beautiful steps tracking application for iOS</span>');
      addLine('<span class="text-[#a0a0a0]">with seamless HealthKit integration and a focus</span>');
      addLine('<span class="text-[#a0a0a0]">on user experience and clean design.</span>');
      addLine('');
      addLine('<span class="text-[#27ca3f]">→</span> <span class="text-[#a0a0a0]">Tech:</span>      <span class="text-white">Expo, SwiftUI, HealthKit</span>');
      addLine('<span class="text-[#27ca3f]">→</span> <span class="text-[#a0a0a0]">Platform:</span>  <span class="text-white">iOS</span>');
      addLine('<span class="text-[#27ca3f]">→</span> <span class="text-[#a0a0a0]">Status:</span>    <span class="text-[#27ca3f]">Active</span>');
      addLine('');
      addLine('<span class="text-[#6bc1ff]">→ <a href="/stride" class="underline hover:text-white">View Project Page</a></span>');
      addLine('');
    }
  }

  function showSkills() {
    addLine('');
    addLine('<span class="text-[#6bc1ff]">━━━ Skills ━━━</span>');
    addLine('');
    addLine('<span class="text-[#ffbd2e]">Languages</span>');
    addLine('  <span class="text-white">JavaScript</span>  <span class="text-[#27ca3f]">████████████████████</span> Expert');
    addLine('  <span class="text-white">TypeScript</span>  <span class="text-[#27ca3f]">██████████████████░░</span> Advanced');
    addLine('  <span class="text-white">Python</span>      <span class="text-[#27ca3f]">██████████████░░░░░░</span> Intermediate');
    addLine('');
    addLine('<span class="text-[#ffbd2e]">Frameworks</span>');
    addLine('  <span class="text-white">React</span>       <span class="text-[#6bc1ff]">████████████████████</span> Expert');
    addLine('  <span class="text-white">Next.js</span>       <span class="text-[#6bc1ff]">████████████████████</span> Expert');
    addLine('  <span class="text-white">Astro</span>       <span class="text-[#6bc1ff]">████████████████████</span> Expert');
    addLine('  <span class="text-white">Tailwind CSS</span>       <span class="text-[#6bc1ff]">████████████████████</span> Expert');
    addLine('  <span class="text-white">Expo / React Native</span>       <span class="text-[#6bc1ff]">████████████████░░░░</span> Advanced');
    addLine('  <span class="text-white">Node.js</span>     <span class="text-[#6bc1ff]">██████████████████░░</span> Advanced');
    addLine('  <span class="text-white">SwiftUI</span>     <span class="text-[#6bc1ff]">████████████████░░░░</span> Advanced');
    addLine('');
    addLine('<span class="text-[#ffbd2e]">Tools</span>');
    addLine('  <span class="text-[#a0a0a0]">Git, Docker, Figma, Supabase</span>');
    addLine('');
  }

  function showContact() {
    menuMode = true;
    currentMenu = 'contact';
    menuItems = ['email', 'github', 'linkedin', 'x', 'back'];
    menuIndex = 0;

    addLine('');
    addLine('<span class="text-[#6bc1ff]">━━━ Contact ━━━</span>');
    addLine('<span class="text-[#a0a0a0]">Use ↑↓ to navigate, Enter to open link, Esc to go back</span>');
    addLine('');
    renderContactMenu();
  }

  function renderContactMenu() {
    const menuContainer = document.getElementById('contact-menu');
    if (menuContainer) menuContainer.remove();

    const menu = document.createElement('div');
    menu.id = 'contact-menu';

    const contacts = [
      { id: 'email', name: 'Email', value: 'hello@asantinos.com', url: 'mailto:hello@asantinos.com' },
      { id: 'github', name: 'GitHub', value: 'github.com/asantinos', url: 'https://github.com/asantinos' },
      { id: 'linkedin', name: 'LinkedIn', value: 'linkedin.com/in/asantinos', url: 'https://linkedin.com/in/asantinos' },
      { id: 'x', name: 'X', value: 'x.com/alexgrok', url: 'https://x.com/alexgrok' },
    ];

    contacts.forEach((contact, i) => {
      const selected = menuIndex === i;
      menu.innerHTML += `
        <div class="menu-item py-2 px-3 rounded ${selected ? 'selected bg-[#2a2a3e]' : ''}" data-url="${contact.url}">
          <span class="text-[#ffbd2e]">${selected ? '▶' : ' '}</span>
          <span class="text-[#27ca3f] ml-2">${contact.name}</span>
          <span class="text-[#a0a0a0] ml-2">→ ${contact.value}</span>
        </div>
      `;
    });

    // Back option
    const backSelected = menuIndex === contacts.length;
    menu.innerHTML += `
      <div class="menu-item py-2 px-3 rounded mt-2 ${backSelected ? 'selected bg-[#2a2a3e]' : ''}">
        <span class="text-[#ffbd2e]">${backSelected ? '▶' : ' '}</span>
        <span class="text-[#ff5f56] ml-2">← Back</span>
      </div>
    `;

    output.appendChild(menu);
    scrollToBottom();
  }

  function selectContact(index: number) {
    const contacts = [
      { url: 'mailto:hello@asantinos.com' },
      { url: 'https://github.com/asantinos' },
      { url: 'https://linkedin.com/in/asantinos' },
      { url: 'https://x.com/alexgrok' },
    ];

    if (index === menuItems.length - 1) {
      exitMenu();
      addLine('<span class="text-[#a0a0a0]">Returned to main prompt.</span>');
      addLine('');
      return;
    }

    window.open(contacts[index].url, '_blank');
  }

  function exitMenu() {
    menuMode = false;
    currentMenu = '';
    menuItems = [];
    menuIndex = 0;
    const projectsMenu = document.getElementById('projects-menu');
    const contactMenu = document.getElementById('contact-menu');
    if (projectsMenu) projectsMenu.remove();
    if (contactMenu) contactMenu.remove();
  }

  function executeCommand(cmd: string) {
    const trimmed = cmd.trim().toLowerCase();
    addPromptLine(cmd);

    if (trimmed === '') {
      return;
    }

    if (commands[trimmed]) {
      commands[trimmed]();
    } else {
      addLine(`<span class="text-[#ff5f56]">zsh: command not found: ${cmd}</span>`);
      addLine('<span class="text-[#a0a0a0]">Type <span class="text-[#ffbd2e]">help</span> to see available commands.</span>');
      addLine('');
    }

    if (trimmed !== '') {
      commandHistory.unshift(trimmed);
      if (commandHistory.length > 50) commandHistory.pop();
    }
    historyIndex = -1;
  }

  function autocomplete(partial: string): string {
    const matches = commandList.filter(cmd => cmd.startsWith(partial.toLowerCase()));
    if (matches.length === 1) {
      return matches[0];
    } else if (matches.length > 1) {
      addPromptLine(partial);
      addLine('<span class="text-[#a0a0a0]">' + matches.join('  ') + '</span>');
      return partial;
    }
    return partial;
  }

  function updateInput() {
    currentInput.textContent = inputBuffer;
  }

  // Keyboard handler
  terminal.addEventListener('keydown', (e: KeyboardEvent) => {
    if (menuMode) {
      // Menu navigation
      if (e.key === 'ArrowUp') {
        e.preventDefault();
        menuIndex = Math.max(0, menuIndex - 1);
        if (currentMenu === 'projects') renderProjectsMenu();
        if (currentMenu === 'contact') renderContactMenu();
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        menuIndex = Math.min(menuItems.length - 1, menuIndex + 1);
        if (currentMenu === 'projects') renderProjectsMenu();
        if (currentMenu === 'contact') renderContactMenu();
      } else if (e.key === 'Enter') {
        e.preventDefault();
        if (currentMenu === 'projects') selectProject(menuIndex);
        if (currentMenu === 'contact') selectContact(menuIndex);
      } else if (e.key === 'Escape') {
        e.preventDefault();
        exitMenu();
        addLine('<span class="text-[#a0a0a0]">Returned to main prompt.</span>');
        addLine('');
      }
      return;
    }

    // Normal command mode
    if (e.key === 'Enter') {
      e.preventDefault();
      executeCommand(inputBuffer);
      inputBuffer = '';
      updateInput();
    } else if (e.key === 'Backspace') {
      e.preventDefault();
      inputBuffer = inputBuffer.slice(0, -1);
      updateInput();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (commandHistory.length > 0) {
        historyIndex = Math.min(historyIndex + 1, commandHistory.length - 1);
        inputBuffer = commandHistory[historyIndex];
        updateInput();
      }
    } else if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (historyIndex > 0) {
        historyIndex--;
        inputBuffer = commandHistory[historyIndex];
      } else {
        historyIndex = -1;
        inputBuffer = '';
      }
      updateInput();
    } else if (e.key === 'Tab') {
      e.preventDefault();
      inputBuffer = autocomplete(inputBuffer);
      updateInput();
    } else if (e.key === 'Escape') {
      e.preventDefault();
      inputBuffer = '';
      updateInput();
    } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
      e.preventDefault();
      inputBuffer += e.key;
      updateInput();
    } else if (e.ctrlKey && e.key === 'l') {
      e.preventDefault();
      clearTerminal();
    } else if (e.ctrlKey && e.key === 'c') {
      e.preventDefault();
      addPromptLine(inputBuffer + '^C');
      inputBuffer = '';
      updateInput();
    }
  });

  // Focus terminal on click
  terminal.addEventListener('click', () => {
    terminal.focus();
  });

  // Initialize on DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    terminal.focus();
    showWelcome();
  });
</script>
